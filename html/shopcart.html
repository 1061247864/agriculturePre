<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Document</title>
  <script src="../res/static/js/vue.js"></script>
  <script type="text/javascript" src="../res/static/js/jquery.min.js"></script>
  <link rel="stylesheet" type="text/css" href="../res/static/css/main.css">
  <link rel="stylesheet" type="text/css" href="../res/layui/css/layui.css">
  <script src="https://cdn.staticfile.org/vue-resource/1.5.1/vue-resource.min.js"></script>
  <script type="text/javascript" src="../res/layui/layui.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
</head>
<body>
<div id="app">
  <div id="title">

  </div>



  <div class="header" style="background-color: #DDDDDD;">
    <div class="headerLayout w1200">
      <div class="headerCon">
        <h1 class="mallLogo">
          <a href="#" title="智慧农贸">
            <img src="../res/static/img/logo2.png">
          </a>
        </h1>
        <div class="mallSearch">
          <form action="" class="layui-form" novalidate>
            <input type="text" name="title" required  lay-verify="required" autocomplete="off" class="layui-input" placeholder="请输入需要的商品">
            <button class="layui-btn" lay-submit lay-filter="formDemo">
                <i class="layui-icon layui-icon-search"></i>
            </button>
            <input type="hidden" name="" value="">
          </form>
        </div>
      </div>
    </div>
  </div>


  <div class="content content-nav-base shopcart-content">
    <div class="main-nav">
      <div class="inner-cont0">
        <div class="inner-cont1 w1200">
          <div class="inner-cont2">
            <a href="commodity.html" class="active">所有商品</a>
            <a href="buytoday.html">今日团购</a>
            <a href="information.html">母婴资讯</a>
            <a href="about.html">关于我们</a>
          </div>
        </div>
      </div>
    </div>
    <div class="banner-bg w1200">
     <!-- <h3>夏季清仓</h3>
      <p>宝宝被子、宝宝衣服3折起</p>-->
    </div>
    <div class="cart w1200">
      <div class="cart-table-th">
        <div class="th th-chk">
          <div class="select-all">
            <div class="cart-checkbox">
              <input class="check-all check" id="allCheckked" type="checkbox" value="true">
            </div>
          <label>&nbsp;&nbsp;全选</label>
          </div>
        </div>
        <div class="th th-item">
          <div class="th-inner">
            商品
          </div>
        </div>
        <div class="th th-price">
          <div class="th-inner">
            单价
          </div>
        </div>
        <div class="th th-amount">
          <div class="th-inner">
            数量
          </div>
        </div>
        <div class="th th-sum">
          <div class="th-inner">
            小计
          </div>
        </div>
        <div class="th th-op">
          <div class="th-inner">
            操作
          </div>
        </div>
      </div>
      <div class="OrderList">
        <div class="order-content" id="list-cont">
          <ul class="item-content layui-clear" v-if="flag" v-for="(item , index) in shopCart.shopcItem">
            <li class="th th-chk">
              <div class="select-all">
                <div class="cart-checkbox">
                  <input class="CheckBoxShop check" id="a" type="checkbox" num="all" name="select-all" value="true">
                  <input type="hidden" :value="item.shopcitemId"/>
                </div>
              </div>
            </li>
            <li class="th th-item">
              <div class="item-cont">
                <a href="javascript:;"><img :src="'../res/static/img/'+item.goods.photo" alt=""></a>
                <div class="text">
                  <div class="title">{{item.goods.goodName}}</div>
                  <p>{{item.goods.context}}</p>
                </div>
              </div>
            </li>
            <li class="th th-price">
              <span class="th-su">{{item.goods.price}} {{item.goods.company}}</span>
            </li>
            <li class="th th-amount">`
              <div class="box-btn layui-clear">
                <div class="less layui-btn" @click="updCart(item.shopcitemId,'true',index)">-</div>
                <input class="Quantity-input" type="" :id="'a'+item.shopcitemId"  :value="item.count" disabled="disabled">
                <div class="add layui-btn" @click="updCart(item.shopcitemId,'false',index)">+</div>
              </div>
            </li>
            <li class="th th-sum">
              <span class="sum">{{item.goods.price*item.count}}</span>
            </li>
            <li class="th th-op">
              <span @click="delShopcItem(item.shopcitemId)">删除</span>
            </li>
          </ul>
          <h1  v-if="flag==false"  align="center">购物车中没有任何商品</h1>
         <!-- <ul class="item-content layui-clear">
            <li class="th th-chk">
              <div class="select-all">
                <div class="cart-checkbox">
                  <input class="CheckBoxShop check" id="" type="checkbox" num="all" name="select-all" value="true">
                </div>
              </div>
            </li>
            <li class="th th-item">
              <div class="item-cont">
                <a href="javascript:;"><img src="../res/static/img/paging_img2.jpg" alt=""></a>
                <div class="text">
                  <div class="title">宝宝T恤棉质小衫</div>
                  <p><span>粉色</span>  <span>130</span>cm</p>
                </div>
              </div>
            </li>
            <li class="th th-price">
              <span class="th-su">189.00</span>
            </li>
            <li class="th th-amount">
              <div class="box-btn layui-clear">
                <div class="less layui-btn">-</div>
                <input class="Quantity-input" type="" name="" value="1" disabled="disabled">
                <div class="add layui-btn">+</div>
              </div>
            </li>
            <li class="th th-sum">
              <span class="sum">189.00</span>
            </li>
            <li class="th th-op">
              <span class="dele-btn">删除</span>
            </li>
          </ul>
          <ul class="item-content layui-clear">
            <li class="th th-chk">
              <div class="select-all">
                <div class="cart-checkbox">
                  <input class="CheckBoxShop check" id="" type="checkbox" num="all" name="select-all" value="true">
                </div>
              </div>
            </li>
            <li class="th th-item">
              <div class="item-cont">
                <a href="javascript:;"><img src="../res/static/img/paging_img3.jpg" alt=""></a>
                <div class="text">
                  <div class="title">宝宝T恤棉质小衫</div>
                  <p><span>粉色</span>  <span>130</span>cm</p>
                </div>
              </div>
            </li>
            <li class="th th-price">
              <span class="th-su">189.00</span>
            </li>
            <li class="th th-amount">
              <div class="box-btn layui-clear">
                <div class="less layui-btn">-</div>
                <input class="Quantity-input" type="" name="" value="1" disabled="disabled">
                <div class="add layui-btn">+</div>
              </div>
            </li>
            <li class="th th-sum">
              <span class="sum">189.00</span>
            </li>
            <li class="th th-op">
              <span class="dele-btn">删除</span>
            </li>
          </ul>-->
        </div>
      </div>


      <!-- 模版导入数据 -->
      <!-- <script type="text/html" id="demo">
        {{# layui.each(d.infoList,function(index,item){}}
          <ul class="item-content layui-clear">
            <li class="th th-chk">
              <div class="select-all">
                <div class="cart-checkbox">
                  <input class="CheckBoxShop check" id="" type="checkbox" num="all" name="select-all" value="true">
                </div>
              </div>
            </li>
            <li class="th th-item">
              <div class="item-cont">
                <a href="javascript:;"><img src="../res/static/img/paging_img1.jpg" alt=""></a>
                <div class="text">
                  <div class="title">宝宝T恤棉质小衫</div>
                  <p><span>粉色</span>  <span>130</span>cm</p>
                </div>
              </div>
            </li>
            <li class="th th-price">
              <span class="th-su">189.00</span>
            </li>
            <li class="th th-amount">
              <div class="box-btn layui-clear">
                <div class="less layui-btn">-</div>
                <input class="Quantity-input" type="" name="" value="1" disabled="disabled">
                <div class="add layui-btn">+</div>
              </div>
            </li>
            <li class="th th-sum">
              <span class="sum">189.00</span>
            </li>
            <li class="th th-op">
              <span class="dele-btn">删除</span>
            </li>
          </ul>
        {{# });}}
      </script> -->


      <div v-if="flag" class="FloatBarHolder layui-clear">
        <div class="th th-chk">
          <div class="select-all">
            <div class="cart-checkbox">
              <input class="check-all check" id="" name="select-all" type="checkbox"  value="true">
            </div>
            <label>&nbsp;&nbsp;已选<span class="Selected-pieces">0</span>件</label>
          </div>
        </div>
        <div class="th batch-deletion">
          <span @click.stop="delShopcItem(null)">批量删除</span>
        </div>
        <div class="th Settlement">
          <button class="layui-btn">结算</button>
        </div>
        <div class="th total">
          <p>应付：<span class="pieces-total">0</span></p>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="../res/static/js/publicValue.js"></script>
<script type="text/javascript">
  layui.config({
    base: '../res/static/js/util/' //你存放新模块的目录，注意，不是layui的模块目录
  }).use(['mm','jquery','element','car'],function(){
    var mm = layui.mm,$ = layui.$,element = layui.element,car = layui.car;

    // 模版导入数据
    // var html = demo.innerHTML,
    // listCont = document.getElementById('list-cont');
    // mm.request({
    //   url: '../json/shopcart.json',
    //   success : function(res){
    //     listCont.innerHTML = mm.renderHtml(html,res)
    //     element.render();
    //     car.init()
    //   },
    //   error: function(res){
    //     console.log(res);
    //   }
    // })
    //
    car.init()


  });

document.getElementById("title").innerHTML=titleObj;
  var app = new Vue({
    el:"#app",
    data:{

      userobj:{},
      shopCart:[],
      flag:true
    },
    mounted:function(){
     // app.prototype.$http=require('axios');
      this.userobj=JSON.parse(window.localStorage.getItem("userKey"));
      if (this.userobj) {
        this.gerCurrentUser();
      }
      /*if ((JSON.parse(window.localStorage.getItem("scid")))!=null){
        this.shopCart = JSON.parse(window.localStorage.getItem("scid"));
      }
      alert(JSON.stringify(this.shopCart));*/
      if ((JSON.parse(window.localStorage.getItem("scid")))!=null) {
        this.$http.post(urlprofix + '/consumer/shopCart/getShopCartById?shopcId=' + (JSON.parse(window.localStorage.getItem("scid"))).shopcId, "", {
          emulateJSON: true
        }).then(function (res) {
          this.shopCart = res.body;
          window.localStorage.setItem("scid", JSON.stringify(this.shopCart));
        }, function () {
          console.log('请求处理失败');
        });
        //this.shopCart = JSON.parse(window.localStorage.getItem("scid"));


      }else{
        this.flag=false;
      }
    },
    methods:{

      updCart:function(itemId,flag,index){
        if(flag=='false'){
          this.shopCart.shopcItem[index].count= this.shopCart.shopcItem[index].count+1;

          this.$http.post(urlprofix + '/consumer/shopCart/updShopcItem?shopcitemId='+itemId+"&count="
                  +this.shopCart.shopcItem[index].count+"&shopcId="+this.shopCart.shopcId, "", {
            emulateJSON: true
          }).then(function (res) {
            this.shopCart = res.body;
            window.localStorage.setItem("scid", JSON.stringify(this.shopCart));
          }, function () {
            console.log('请求处理失败');
          });

        }else{
          if (this.shopCart.shopcItem[index].count-1!=0) {

            this.shopCart.shopcItem[index].count= this.shopCart.shopcItem[index].count-1;
            this.$http.post(urlprofix + '/consumer/shopCart/updShopcItem?shopcitemId='+itemId+"&count="
                    +this.shopCart.shopcItem[index].count+"&shopcId="+this.shopCart.shopcId, "", {
              emulateJSON: true
            }).then(function (res) {
              this.shopCart = res.body;
              window.localStorage.setItem("scid", JSON.stringify(this.shopCart));
            }, function () {
              console.log('请求处理失败');
            });

          }
        }
      },
      delShopcItem:function(shopcItemId){
        layer.confirm("是否删除", {btn: ['确定', '取消'], title: "提示"},  () =>{
          var shopcItem = new Array();
         if(shopcItemId!=null){
           shopcItem.push(shopcItemId);
         }else{
           //alert(jQuery("#list-cont input:checkbox:checked").serialize());
           jQuery("#list-cont input:checkbox:checked").each(function () {
             shopcItem.push(jQuery(this).next().val());
           });
         }

          this.$http.post(urlprofix + '/consumer/shopCart/delCartItems?itemId='+shopcItem+"&shopcId="+this.shopCart.shopcId, "", {
            emulateJSON: true
          }).then(function (res) {
            if(res.body.length!=0){
              this.shopCart = res.body;
              window.localStorage.setItem("scid", JSON.stringify(this.shopCart));
              layer.msg("删除成功！",{
                icon:1
              });
            }else{
              window.localStorage.removeItem("scid");
              this.shopCart=[];
              this.flag=false;
              layer.msg("删除成功！",{
                icon:1
              });
            }
          }, function () {
            console.log('请求处理失败');
          });
        })
      },
      logout:function(){
        layer.confirm(this.userobj.userName+":是否退出登录", {btn: ['确定', '取消'], title: "提示"},  () =>{
          window.localStorage.removeItem("userKey")
          this.userobj=null;
          layer.msg("退出登录！",{
            icon:7,
            time:2000
          },function (){
            window.location.href="login.html";
          })
        })
      },gerCurrentUser:function(){
        /*this.$http.options={withCredentials: true}*/
        this.$http.get(urlprofix+"consumer/user/getCurrentUser",{credentials: true},{
          emulateJSON:true
        }).then(function(result){
          if(!result.body){
            this.userobj=null;
            window.localStorage.removeItem("userKey")
          }
        })

      }
    }
  });

/*var app = new Vue({
  el: "#app",
  data: {
    userobj: {},
  },

  mounted: function () {


    this.userobj = JSON.parse(window.localStorage.getItem("userKey"));
    if (this.userobj) {
      this.gerCurrentUser();
    }

  },
  watch: {},
  created: function () {


  },
  computed: {},

  methods: {
    registry: function () {


      if (this.registryValidata()) {
        const userCode = jQuery("#userCode").val();
        const email = jQuery("#email").val();
        this.$http.post(urlprofix + "userv/user/isExistence", {userCode: userCode, email: email}, {
          emulateJSON: true
        }).then(function (result) {
          if (result.body.message) {
            layer.msg(result.body.message, {
              icon: 2
            })
          } else {
            var data = jQuery(".layui-form-item input[name]").serializeArray();
            var dataJson = {};
            for (const i in data) {
              dataJson[data[i].name] = data[i].value;
            }
            this.$http.post(urlprofix + "consumer/user/registry", dataJson, {
              emulateJSON: true,
              withCredentials: true
            }).then(function (result) {
              layer.msg(result.body.message, {
                icon: result.body.isregistry == "false" ? 2 : 1
              }, function () {
                if (result.body.isregistry == "true") {
                  window.location.href = "login.html"
                }
              })
            })
          }
        })


      }
    }
    ,
    validataPassword2: function () {
      if (jQuery("#password2").val() != jQuery("#password").val()) {
        layer.msg("密码不一致", {
          icon: 2
        });
      }
    },
    validata: function () {

    }
    ,
    registryValidata: function () {

      var bool = true;
      jQuery(".layui-form-item input[name]").each(function () {
        if (jQuery(this).val() == null || jQuery(this).val() == '') {
          layer.msg(jQuery(this).attr("placeholder") + "不能为空！")
          bool = false;
          return bool;
        }


      })
      if (bool) {
        this.validataPassword2();
      }
      if (bool) {
        const emailReg = /^[0-9a-zA-Z]{6,18}@((qq)|(163)|(sina)|(gmail))((.com)|(.cn))$/;
        const email = jQuery("#email").val();

        if (!emailReg.test(email)) {
          layer.msg("邮箱格式不正确[格式 ：{6-18@host(.com|.cn)]", {
            icon: 2
          })
          bool = false;
        }
      }
      return bool;
    }
    ,
    gerCurrentUser: function () {
      /!*this.$http.options={withCredentials: true}*!/
      this.$http.get(urlprofix + "consumer/user/getCurrentUser", {credentials: true}, {
        emulateJSON: true
      }).then(function (result) {
        if (!result.body) {
          this.userobj = null;
          window.localStorage.removeItem("userKey")
        }
      })
    },

    logout: function () {
      layer.confirm(this.userobj.userName + ":是否退出登录", {btn: ['确定', '取消'], title: "提示"}, () => {
        window.localStorage.removeItem("userKey")
        this.userobj = null;
        layer.msg("退出登录！", {
          icon: 7,
          time: 2000
        })
      })
    },


  }
})*/


</script>
</body>
</html>